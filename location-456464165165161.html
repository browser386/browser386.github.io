<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>视频 + 定位示例</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  video { width: 100%; max-width: 600px; display: block; margin-bottom: 20px; }
  button { padding: 10px 20px; font-size: 16px; }
  #output { margin-top: 20px; white-space: pre-wrap; background: #f0f0f0; padding: 10px; border-radius: 5px; }
</style>
</head>
<body>

<h2>视频播放 + 定位示例</h2>

<video id="myVideo" autoplay muted controls playsinline loop>
  <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
  您的浏览器不支持 video 标签。
</video>

<button id="locButton">点击获取当前位置并启动定时输出</button>

<div id="output"></div>

<script>
let lastPos = null;
let timerId = null; // 用于保存定时器 ID

// 持续监听位置变化
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(
    pos => {
      lastPos = pos;
      const now = new Date().toLocaleString();
      const output = `[${now}] watchPosition回调获取位置: lat=${pos.coords.latitude}, lon=${pos.coords.longitude}\n`;
      console.log(output);
      document.getElementById('output').textContent += output;      
    },
    err => {
      console.error('watchPosition定位失败:', err);
      document.getElementById('output').textContent += 'watchPosition定位失败: ' + err.message + '\n';
    },
    { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
  );
}

// 按钮点击获取一次位置，并启动定时器
document.getElementById('locButton').addEventListener('click', () => {
  // 清除之前的定时器（如果有）
  if (timerId) {
    clearInterval(timerId);
    timerId = null;
  }

  // 启动新的定时器，每10秒输出最新位置
  timerId = setInterval(() => {
  if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          const now = new Date().toLocaleString();
          const output = `[${now}] getCurrentPosition按钮点击获取位置: lat=${pos.coords.latitude}, lon=${pos.coords.longitude}\n`;
          console.log(output);
          document.getElementById('output').textContent += output;
        },
        err => {
          const now = new Date().toLocaleString();
          const output = `[${now}] getCurrentPosition按钮点击获取位置失败\n`;          
          console.error(output);
          document.getElementById('output').textContent += output;
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
      );
    }
  }, 20000);
});
</script>

</body>
</html>
